{"version":3,"file":"csk.js","sources":["../src/preferences/csk/setkey.ts","../src/preferences/csk/page.tsx","../src/preferences/hashchange.ts","../src/preferences/csk/index.tsx","../src/preferences/csk/category.tsx","../src/preferences/index.ts"],"sourcesContent":["/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { createEffect, createSignal } from \"solid-js\";\r\nimport {\r\n  type CSKCommands,\r\n  type CSKData,\r\n  zCSKData,\r\n} from \"../../components/custom-shortcut-key/defines\";\r\nimport type { commands } from \"../../components/custom-shortcut-key/commands\";\r\nimport { checkIsSystemShortcut } from \"../../components/custom-shortcut-key/utils\";\r\nimport { create } from \"sortablejs\";\r\n\r\nexport const [editingStatus, setEditingStatus] = createSignal<string | null>(\r\n  null,\r\n);\r\nexport const [currentFocus, setCurrentFocus] = createSignal<\r\n  keyof typeof commands | null\r\n>(null);\r\n\r\ncreateEffect(() => {\r\n  console.log(currentFocus() !== null);\r\n  Services.obs.notifyObservers(\r\n    {},\r\n    \"nora-csk\",\r\n    JSON.stringify({\r\n      type: \"disable-csk\",\r\n      data: currentFocus() !== null,\r\n    } as CSKCommands),\r\n  );\r\n});\r\n\r\nexport const [cskData, setCSKData] = createSignal(\r\n  //TODO: safely catch\r\n  zCSKData.parse(\r\n    JSON.parse(\r\n      Services.prefs.getStringPref(\"floorp.browser.nora.csk.data\", \"{}\"),\r\n    ),\r\n  ),\r\n);\r\n\r\nexport function cskDatumToString(data: CSKData, key: keyof CSKData) {\r\n  //TODO: Meta key\r\n  if (key in data) {\r\n    const datum = data[key];\r\n    return `${datum?.modifiers.ctrl ? \"Ctrl + \" : \"\"}${\r\n      datum?.modifiers.alt ? \"Alt + \" : \"\"\r\n    }${datum?.modifiers.shift ? \"Shift + \" : \"\"}${datum?.key}`;\r\n  }\r\n  return \"\";\r\n}\r\n\r\ncreateEffect(() => {\r\n  Services.prefs.setStringPref(\r\n    \"floorp.browser.nora.csk.data\",\r\n    JSON.stringify(cskData()),\r\n  );\r\n  Services.obs.notifyObservers(\r\n    {},\r\n    \"nora-csk\",\r\n    JSON.stringify({\r\n      type: \"update-pref\",\r\n    } as CSKCommands),\r\n  );\r\n});\r\n\r\nexport function initSetKey() {\r\n  document.addEventListener(\"keydown\", (ev) => {\r\n    const key = ev.key;\r\n    const alt = ev.altKey;\r\n    const ctrl = ev.ctrlKey;\r\n    const shift = ev.shiftKey;\r\n    const meta = ev.metaKey;\r\n\r\n    // If shift is pressed without any other modifier, it's a system shortcut\r\n    if (shift && !alt && !ctrl && !meta) {\r\n      return;\r\n    }\r\n\r\n    if (key === \"Escape\" || key === \"Tab\") {\r\n      return;\r\n    }\r\n\r\n    const focus = currentFocus();\r\n\r\n    if (!(alt || ctrl || shift || meta)) {\r\n      if (key === \"Delete\" || key === \"Backspace\") {\r\n        if (focus) {\r\n          ev.preventDefault();\r\n          const temp = cskData();\r\n          for (const key of Object.keys(temp)) {\r\n            if (key === focus) {\r\n              delete temp[key];\r\n              setCSKData(temp);\r\n              setEditingStatus(cskDatumToString(cskData(), focus));\r\n              break;\r\n            }\r\n          }\r\n          console.log(cskData());\r\n        }\r\n        return;\r\n      }\r\n    }\r\n\r\n    // on register\r\n\r\n    if (focus) {\r\n      ev.preventDefault();\r\n      if (\r\n        [\"Control\", \"Alt\", \"Meta\", \"Shift\"].filter((k) => key.includes(k))\r\n          .length === 0\r\n      ) {\r\n        if (checkIsSystemShortcut(ev)) {\r\n          console.warn(`This Event is registered in System: ${ev}`);\r\n          return;\r\n        }\r\n        setCSKData({\r\n          ...cskData(),\r\n          [focus]: {\r\n            key: key,\r\n            modifiers: {\r\n              alt,\r\n              ctrl,\r\n              meta,\r\n              shift,\r\n            },\r\n          },\r\n        });\r\n        setEditingStatus(cskDatumToString(cskData(), focus));\r\n      }\r\n    }\r\n  });\r\n}\r\n","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { For } from \"solid-js\";\r\nimport {\r\n  cskData,\r\n  cskDatumToString,\r\n  currentFocus,\r\n  editingStatus,\r\n  setCurrentFocus,\r\n  setEditingStatus,\r\n} from \"./setkey\";\r\nimport {\r\n  commands,\r\n  csk_category,\r\n} from \"../../components/custom-shortcut-key/commands\";\r\n\r\nexport const CustomShortcutKeyPage = () => {\r\n  return (\r\n    <>\r\n      <div>\r\n        <h1 data-l10n-id=\"floorp-CSK-title\" />\r\n        <xul:description\r\n          class=\"indent tip-caption\"\r\n          data-l10n-id=\"floorp-CSK-description\"\r\n        />\r\n        <xul:checkbox data-l10n-id=\"disable-fx-actions\" />\r\n      </div>\r\n      <For each={csk_category}>\r\n        {(category) => (\r\n          <xul:vbox class=\"csks-content-box\">\r\n            <h2\r\n              data-l10n-id={\"floorp-custom-actions-\" + category}\r\n              class=\"csks-box-title\"\r\n            >\r\n              {category}\r\n            </h2>\r\n            <For each={Object.entries(commands)}>\r\n              {([key, value]) =>\r\n                value.type === category ? (\r\n                  <div class=\"csks-box-item\" style={{ display: \"flex\" }}>\r\n                    <label\r\n                      style={{ \"flex-grow\": \"1\" }}\r\n                      data-l10n-id={\r\n                        \"floorp-custom-actions-\" +\r\n                        key.replace(\"floorp-\", \"\").replace(\"gecko-\", \"\")\r\n                      }\r\n                    >\r\n                      {key}\r\n                    </label>\r\n                    <input\r\n                      value={\r\n                        currentFocus() === key && editingStatus() !== null\r\n                          ? editingStatus()!\r\n                          : cskDatumToString(cskData(), key)\r\n                      }\r\n                      onFocus={(ev) => {\r\n                        setCurrentFocus(key);\r\n                      }}\r\n                      onBlur={(ev) => {\r\n                        setEditingStatus(null);\r\n                        if (currentFocus() === key) {\r\n                          setCurrentFocus(null);\r\n                        }\r\n                      }}\r\n                      readonly={true}\r\n                      placeholder=\"Type a shortcut\"\r\n                      style={{\r\n                        \"border-radius\": \"4px\",\r\n                        color: \"inherit\",\r\n                        padding: \"6px 10px\",\r\n                        \"background-color\": \"transparent !important\",\r\n                        border:\r\n                          \"1px solid var(--input-border-color) !important\",\r\n                        transition: \"all .2s ease-in-out !important\",\r\n                      }}\r\n                    />\r\n                  </div>\r\n                ) : undefined\r\n              }\r\n            </For>\r\n          </xul:vbox>\r\n        )}\r\n      </For>\r\n    </>\r\n  );\r\n};\r\n","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { createSignal } from \"solid-js\";\r\n\r\nexport const [showCSK, setShowCSK] = createSignal(false);\r\n\r\nconst onHashChange = (ev: Event | null) => {\r\n  switch (location.hash) {\r\n    case \"#csk\": {\r\n      setShowCSK(true);\r\n      break;\r\n    }\r\n    default: {\r\n      setShowCSK(false);\r\n    }\r\n  }\r\n};\r\n\r\nexport function initHashChange() {\r\n  window.addEventListener(\"hashchange\", onHashChange);\r\n  onHashChange(null);\r\n}\r\n","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport type {} from \"solid-styled-jsx\";\r\nimport { CustomShortcutKeyPage } from \"./page\";\r\n\r\nimport { showCSK } from \"../hashchange\";\r\nimport { initSetKey } from \"./setkey\";\r\nimport { Show } from \"solid-js\";\r\n\r\nexport function csk() {\r\n  initSetKey();\r\n  return (\r\n    <section id=\"nora-csk-entry\">\r\n      <Show when={showCSK()}>\r\n        <CustomShortcutKeyPage />\r\n      </Show>\r\n    </section>\r\n  );\r\n}\r\n","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport type {} from \"../../solid-xul/jsx-runtime\";\r\nexport function category() {\r\n  return (\r\n    <xul:richlistitem\r\n      id=\"category-csk\"\r\n      class=\"category\"\r\n      value=\"paneCsk\"\r\n      helpTopic=\"prefs-csk\"\r\n      data-l10n-id=\"category-CSK\"\r\n      data-l10n-attrs=\"tooltiptext\"\r\n      align=\"center\"\r\n    >\r\n      <xul:image class=\"category-icon\" />\r\n      <xul:label\r\n        class=\"category-name\"\r\n        flex=\"1\"\r\n        data-l10n-id=\"category-CSK-title\"\r\n      />\r\n    </xul:richlistitem>\r\n  );\r\n}\r\n","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { insert, render } from \"../solid-xul/solid-xul\";\r\nimport { csk } from \"./csk\";\r\nimport { category } from \"./csk/category\";\r\nimport { initHashChange } from \"./hashchange\";\r\n\r\nexport default function initScripts() {\r\n  const init = () => {\r\n    insert(\r\n      document.querySelector(\"#categories\"),\r\n      category(),\r\n      document.getElementById(\"category-Downloads\"),\r\n    );\r\n    render(csk, document.querySelector(\".pane-container\"));\r\n    initHashChange();\r\n    switch (location.hash) {\r\n      case \"#csk\": {\r\n        document.getElementById(\"category-csk\")?.click();\r\n        break;\r\n      }\r\n    }\r\n  };\r\n\r\n  if (document.readyState !== \"loading\") {\r\n    init();\r\n  } else {\r\n    document.addEventListener(\"DOMContentLoaded\", init);\r\n  }\r\n}\r\n\r\ninitScripts();\r\n"],"names":["key","CustomShortcutKeyPage","_el$","_$createElement","_el$2","_el$3","_el$4","_$insertNode","_$createComponent","For","each","csk_category","children","category","_el$5","_el$6","_$insert","Object","entries","commands","value","type","_el$7","_el$8","_el$9","_$setProp","display","ev","setCurrentFocus","setEditingStatus","currentFocus","color","padding","border","transition","_$effect","_p$","_v$","replace","_v$2","editingStatus","cskDatumToString","cskData","e","t","undefined","csk","Show","when","showCSK"],"mappings":"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"}