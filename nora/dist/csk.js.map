{"version":3,"file":"csk.js","sources":["../src/preferences/csk/setkey.ts","../src/preferences/csk/page.tsx","../src/preferences/hashchange.ts","../src/preferences/csk/index.tsx","../src/preferences/csk/category.tsx","../src/preferences/index.ts"],"sourcesContent":["/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\nimport { createEffect, createSignal } from \"solid-js\";\nimport {\n  type CSKCommands,\n  type CSKData,\n  zCSKData,\n} from \"../../components/custom-shortcut-key/defines\";\nimport type { commands } from \"../../components/custom-shortcut-key/commands\";\nimport { checkIsSystemShortcut } from \"../../components/custom-shortcut-key/utils\";\nimport { create } from \"sortablejs\";\n\nexport const [editingStatus, setEditingStatus] = createSignal<string | null>(\n  null,\n);\nexport const [currentFocus, setCurrentFocus] = createSignal<\n  keyof typeof commands | null\n>(null);\n\ncreateEffect(() => {\n  //console.log(currentFocus() !== null);\n  Services.obs.notifyObservers(\n    {},\n    \"nora-csk\",\n    JSON.stringify({\n      type: \"disable-csk\",\n      data: currentFocus() !== null,\n    } as CSKCommands),\n  );\n});\n\nexport const [cskData, setCSKData] = createSignal(\n  //TODO: safely catch\n  zCSKData.parse(\n    JSON.parse(\n      Services.prefs.getStringPref(\"floorp.browser.nora.csk.data\", \"{}\"),\n    ),\n  ),\n);\n\nexport function cskDatumToString(data: CSKData, key: keyof CSKData) {\n  //TODO: Meta key\n  if (key in data) {\n    const datum = data[key];\n    return `${datum?.modifiers.ctrl ? \"Ctrl + \" : \"\"}${\n      datum?.modifiers.alt ? \"Alt + \" : \"\"\n    }${datum?.modifiers.shift ? \"Shift + \" : \"\"}${datum?.key}`;\n  }\n  return \"\";\n}\n\ncreateEffect(() => {\n  Services.prefs.setStringPref(\n    \"floorp.browser.nora.csk.data\",\n    JSON.stringify(cskData()),\n  );\n  Services.obs.notifyObservers(\n    {},\n    \"nora-csk\",\n    JSON.stringify({\n      type: \"update-pref\",\n    } as CSKCommands),\n  );\n});\n\nexport function initSetKey() {\n  document.addEventListener(\"keydown\", (ev) => {\n    const key = ev.key;\n    const alt = ev.altKey;\n    const ctrl = ev.ctrlKey;\n    const shift = ev.shiftKey;\n    const meta = ev.metaKey;\n\n    // If shift is pressed without any other modifier, it's a system shortcut\n    if (shift && !alt && !ctrl && !meta) {\n      return;\n    }\n\n    if (key === \"Escape\" || key === \"Tab\") {\n      return;\n    }\n\n    const focus = currentFocus();\n\n    if (!(alt || ctrl || shift || meta)) {\n      if (key === \"Delete\" || key === \"Backspace\") {\n        if (focus) {\n          ev.preventDefault();\n          const temp = cskData();\n          for (const key of Object.keys(temp)) {\n            if (key === focus) {\n              delete temp[key];\n              setCSKData(zCSKData.parse(temp));\n              setEditingStatus(cskDatumToString(cskData(), focus));\n              break;\n            }\n          }\n          //console.log(cskData());\n        }\n        return;\n      }\n    }\n\n    // on register\n\n    if (focus) {\n      ev.preventDefault();\n      if (\n        [\"Control\", \"Alt\", \"Meta\", \"Shift\"].filter((k) => key.includes(k))\n          .length === 0\n      ) {\n        if (checkIsSystemShortcut(ev)) {\n          console.warn(`This Event is registered in System: ${ev}`);\n          return;\n        }\n        if (shift&&!(alt||ctrl||meta)&&key){console.warn(\"Shift + [key] is not permitted\");return;}\n        setCSKData({\n          ...cskData(),\n          [focus]: {\n            key: key,\n            modifiers: {\n              alt,\n              ctrl,\n              meta,\n              shift,\n            },\n          },\n        });\n        setEditingStatus(cskDatumToString(cskData(), focus));\n      }\n    }\n  });\n}\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\nimport { For } from \"solid-js\";\nimport {\n  cskData,\n  cskDatumToString,\n  currentFocus,\n  editingStatus,\n  setCurrentFocus,\n  setEditingStatus,\n} from \"./setkey\";\nimport {\n  commands,\n  csk_category,\n} from \"../../components/custom-shortcut-key/commands\";\n\nexport const CustomShortcutKeyPage = () => {\n  return (\n    <>\n      <div>\n        <h1 data-l10n-id=\"floorp-CSK-title\" />\n        <xul:description\n          class=\"indent tip-caption\"\n          data-l10n-id=\"floorp-CSK-description\"\n        />\n        <xul:checkbox data-l10n-id=\"disable-fx-actions\" />\n      </div>\n      <For each={csk_category}>\n        {(category) => (\n          <xul:vbox class=\"csks-content-box\">\n            <h2\n              data-l10n-id={\"floorp-custom-actions-\" + category}\n              class=\"csks-box-title\"\n            >\n              {category}\n            </h2>\n            <For each={Object.entries(commands)}>\n              {([key, value]) =>\n                value.type === category ? (\n                  <div class=\"csks-box-item\" style={{ display: \"flex\" }}>\n                    <label\n                      style={{ \"flex-grow\": \"1\" }}\n                      data-l10n-id={\n                        \"floorp-custom-actions-\" +\n                        key.replace(\"floorp-\", \"\").replace(\"gecko-\", \"\")\n                      }\n                    >\n                      {key}\n                    </label>\n                    <input\n                      value={\n                        currentFocus() === key && editingStatus() !== null\n                          ? editingStatus()!\n                          : cskDatumToString(cskData(), key)\n                      }\n                      onFocus={(ev) => {\n                        setCurrentFocus(key);\n                      }}\n                      onBlur={(ev) => {\n                        setEditingStatus(null);\n                        if (currentFocus() === key) {\n                          setCurrentFocus(null);\n                        }\n                      }}\n                      readonly={true}\n                      placeholder=\"Type a shortcut\"\n                      style={{\n                        \"border-radius\": \"4px\",\n                        color: \"inherit\",\n                        padding: \"6px 10px\",\n                        \"background-color\": \"transparent !important\",\n                        border:\n                          \"1px solid var(--input-border-color) !important\",\n                        transition: \"all .2s ease-in-out !important\",\n                      }}\n                    />\n                  </div>\n                ) : undefined\n              }\n            </For>\n          </xul:vbox>\n        )}\n      </For>\n    </>\n  );\n};\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\nimport { createSignal } from \"solid-js\";\n\nexport const [showCSK, setShowCSK] = createSignal(false);\n\nconst onHashChange = (ev: Event | null) => {\n  switch (location.hash) {\n    case \"#csk\": {\n      setShowCSK(true);\n      break;\n    }\n    default: {\n      setShowCSK(false);\n    }\n  }\n};\n\nexport function initHashChange() {\n  window.addEventListener(\"hashchange\", onHashChange);\n  onHashChange(null);\n}\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\nimport type {} from \"solid-styled-jsx\";\nimport { CustomShortcutKeyPage } from \"./page\";\n\nimport { showCSK } from \"../hashchange\";\nimport { initSetKey } from \"./setkey\";\nimport { Show } from \"solid-js\";\n\nexport function csk() {\n  initSetKey();\n  return (\n    <section id=\"nora-csk-entry\">\n      <Show when={showCSK()}>\n        <CustomShortcutKeyPage />\n      </Show>\n    </section>\n  );\n}\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\nimport type {} from \"../../solid-xul/jsx-runtime\";\nexport function category() {\n  return (\n    <xul:richlistitem\n      id=\"category-csk\"\n      class=\"category\"\n      value=\"paneCsk\"\n      helpTopic=\"prefs-csk\"\n      data-l10n-id=\"category-CSK\"\n      data-l10n-attrs=\"tooltiptext\"\n      align=\"center\"\n    >\n      <xul:image class=\"category-icon\" />\n      <xul:label\n        class=\"category-name\"\n        flex=\"1\"\n        data-l10n-id=\"category-CSK-title\"\n      />\n    </xul:richlistitem>\n  );\n}\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\nimport { insert, render } from \"../solid-xul/solid-xul\";\nimport { csk } from \"./csk\";\nimport { category } from \"./csk/category\";\nimport { initHashChange } from \"./hashchange\";\n\nexport default function initScripts() {\n  const init = () => {\n    insert(\n      document.querySelector(\"#categories\"),\n      category(),\n      document.getElementById(\"category-Downloads\"),\n    );\n    render(csk, document.querySelector(\".pane-container\"));\n    initHashChange();\n    switch (location.hash) {\n      case \"#csk\": {\n        document.getElementById(\"category-csk\")?.click();\n        break;\n      }\n    }\n  };\n\n  if (document.readyState !== \"loading\") {\n    init();\n  } else {\n    document.addEventListener(\"DOMContentLoaded\", init);\n  }\n}\n\ninitScripts();\n"],"names":["key","CustomShortcutKeyPage","_el$","_$createElement","_el$2","_el$3","_el$4","_$insertNode","_$createComponent","For","each","csk_category","children","category","_el$5","_el$6","_$insert","Object","entries","commands","value","type","_el$7","_el$8","_el$9","_$setProp","display","ev","setCurrentFocus","setEditingStatus","currentFocus","color","padding","border","transition","_$effect","_p$","_v$","replace","_v$2","editingStatus","cskDatumToString","cskData","e","t","undefined","csk","Show","when","showCSK"],"mappings":"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"}