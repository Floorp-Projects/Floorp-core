{"version":3,"file":"content.js","sources":["../src/components/custom-shortcut-key/index.ts","../src/content/statusbar/browser-statusbar.tsx","../src/content/statusbar/context-menu.tsx","../src/content/statusbar/statusbar.tsx","../src/content/statusbar/index.tsx","../src/content/context-menu/context-menu.tsx","../src/content/context-menu/browser-context-menu.tsx","../src/content/context-menu/index.tsx","../src/content/private-container/PrivateContainer.ts","../src/content/private-container/browser-private-container.tsx","../src/content/private-container/context-menu.tsx","../src/content/private-container/index.tsx","../src/content/share-mode/browser-share-mode.tsx","../src/content/share-mode/index.tsx","../src/content/browser-action/browser-action.tsx","../src/content/reverse-sidebar-position/reverse-sidebar-position.tsx","../src/content/reverse-sidebar-position/index.ts","../src/content/undo-closed-tab/browser-undo-closed-tab.tsx","../src/content/undo-closed-tab/index.ts","../src/content/profile-manager/menupopup.tsx","../src/content/profile-manager/browser-profile-manager.tsx","../src/content/profile-manager/index.ts","../src/content/index.ts"],"sourcesContent":["/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { commands } from \"./commands\";\r\nimport { zCSKCommands, zCSKData, type CSKData } from \"./defines\";\r\nimport { checkIsSystemShortcut } from \"./utils\";\r\n\r\nexport class CustomShortcutKey {\r\n  private static instance: CustomShortcutKey;\r\n  private static windows: Window[] = [];\r\n\r\n  //this boolean disable shortcut of csk\r\n  //useful for registering\r\n  disable_csk = false;\r\n  static getInstance() {\r\n    if (!CustomShortcutKey.instance) {\r\n      CustomShortcutKey.instance = new CustomShortcutKey();\r\n    }\r\n    if (!CustomShortcutKey.windows.includes(window)) {\r\n      CustomShortcutKey.instance.startHandleShortcut(window);\r\n      CustomShortcutKey.windows.push(window);\r\n      console.log(\"add window\");\r\n    }\r\n    //@ts-ignore\r\n    Services.obs.addObserver(CustomShortcutKey.instance, \"nora-csk\");\r\n    return CustomShortcutKey.instance;\r\n  }\r\n\r\n  //@ts-ignore\r\n  observe(_subj, _topic, data: string) {\r\n    const d = zCSKCommands.safeParse(JSON.parse(data));\r\n    if (d.success) {\r\n      switch (d.data.type) {\r\n        case \"disable-csk\": {\r\n          this.disable_csk = d.data.data;\r\n          break;\r\n        }\r\n        case \"update-pref\": {\r\n          this.initCSKData();\r\n          console.log(this.cskData);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  cskData: CSKData = {};\r\n  private constructor() {\r\n    this.initCSKData();\r\n\r\n    console.warn(\"CSK Init Completed\");\r\n  }\r\n\r\n  private initCSKData() {\r\n    //TODO: safely catch\r\n    this.cskData = zCSKData.parse(\r\n      JSON.parse(\r\n        Services.prefs.getStringPref(\"floorp.browser.nora.csk.data\", \"{}\"),\r\n      ),\r\n    );\r\n  }\r\n  private startHandleShortcut(_window: Window) {\r\n    _window.addEventListener(\"keydown\", (ev) => {\r\n      if (this.disable_csk) {\r\n        console.log(\"disable-csk\");\r\n        return;\r\n      }\r\n      if (\r\n        [\"Control\", \"Alt\", \"Meta\", \"Shift\"].filter((k) => ev.key.includes(k))\r\n          .length === 0\r\n      ) {\r\n        if (checkIsSystemShortcut(ev)) {\r\n          console.warn(`This Event is registered in System: ${ev}`);\r\n          return;\r\n        }\r\n\r\n        for (const [_key, shortcutDatum] of Object.entries(this.cskData)) {\r\n          const key = _key as keyof CSKData;\r\n          const { alt, ctrl, meta, shift } = shortcutDatum!.modifiers;\r\n          if (\r\n            ev.altKey === alt &&\r\n            ev.ctrlKey === ctrl &&\r\n            ev.metaKey === meta &&\r\n            ev.shiftKey === shift &&\r\n            ev.key === shortcutDatum!.key\r\n          ) {\r\n            commands[key].command(ev);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { createEffect, createSignal } from \"solid-js\";\r\nimport type {} from \"solid-styled-jsx\";\r\n\r\nexport const [showStatusbar, setShowStatusbar] = createSignal(\r\n  Services.prefs.getBoolPref(\"browser.display.statusbar\", false),\r\n);\r\nexport class gFloorpStatusBar {\r\n  private static instance: gFloorpStatusBar;\r\n  public static getInstance() {\r\n    if (!gFloorpStatusBar.instance) {\r\n      gFloorpStatusBar.instance = new gFloorpStatusBar();\r\n    }\r\n    return gFloorpStatusBar.instance;\r\n  }\r\n\r\n  private get statusbarEnabled() {\r\n    return Services.prefs.getBoolPref(\"browser.display.statusbar\", false);\r\n  }\r\n\r\n  constructor() {\r\n    window.CustomizableUI.registerArea(\"statusBar\", {\r\n      type: window.CustomizableUI.TYPE_TOOLBAR,\r\n      defaultPlacements: [\"screenshot-button\", \"fullscreen-button\"],\r\n    });\r\n    window.CustomizableUI.registerToolbarNode(\r\n      document.getElementById(\"statusBar\"),\r\n    );\r\n\r\n    createEffect(() => {\r\n      const statuspanel_label = document.getElementById(\r\n        \"statuspanel-label\",\r\n      ) as XULElement;\r\n      const statuspanel = document.getElementById(\"statuspanel\") as XULElement;\r\n      const statusText = document.getElementById(\"status-text\") as XULElement;\r\n      const observer = new MutationObserver(() => {\r\n        if (statuspanel.getAttribute(\"inactive\") === \"true\" && statusText) {\r\n          statusText.setAttribute(\"hidden\", \"true\");\r\n        } else {\r\n          statusText?.removeAttribute(\"hidden\");\r\n        }\r\n      });\r\n\r\n      Services.prefs.setBoolPref(\"browser.display.statusbar\", showStatusbar());\r\n      if (showStatusbar()) {\r\n        statusText?.appendChild(statuspanel_label!);\r\n        observer.observe(statuspanel, { attributes: true });\r\n      } else {\r\n        statuspanel?.appendChild(statuspanel_label!);\r\n        observer?.disconnect();\r\n      }\r\n    });\r\n\r\n    //move elem to bottom of window\r\n    document.body?.appendChild(document.getElementById(\"statusBar\")!);\r\n    this.observeStatusbar();\r\n  }\r\n\r\n  private observeStatusbar() {\r\n    Services.prefs.addObserver(\"browser.display.statusbar\", () =>\r\n      setShowStatusbar(() => this.statusbarEnabled),\r\n    );\r\n  }\r\n}\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { showStatusbar, setShowStatusbar } from \"./browser-statusbar\";\r\n\r\nexport function ContextMenu() {\r\n  return (\r\n    <xul:menuitem\r\n      data-l10n-id=\"status-bar\"\r\n      label=\"Status Bar\"\r\n      type=\"checkbox\"\r\n      id=\"toggle_statusBar\"\r\n      checked={showStatusbar()}\r\n      onCommand={() => setShowStatusbar((value) => !value)}\r\n    />\r\n  );\r\n}\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { showStatusbar } from \"./browser-statusbar\";\r\nimport statusbarStyle from \"./statusbar.pcss?inline\";\r\n\r\nexport function StatusBar() {\r\n  return (\r\n    <>\r\n      <xul:toolbar\r\n        id=\"statusBar\"\r\n        toolbarname=\"Status bar\"\r\n        customizable=\"true\"\r\n        class={`browser-toolbar customization-target ${\r\n          showStatusbar() ? \"\" : \"collapsed\"\r\n        }`}\r\n        mode=\"icons\"\r\n        context=\"toolbar-context-menu\"\r\n        accesskey=\"A\"\r\n      >\r\n        <xul:hbox\r\n          id=\"status-text\"\r\n          align=\"center\"\r\n          flex=\"1\"\r\n          class=\"statusbar-padding\"\r\n        />\r\n      </xul:toolbar>\r\n      <style jsx>{statusbarStyle}</style>\r\n    </>\r\n  );\r\n}\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { insert, render } from \"@solid-xul/solid-xul\";\r\nimport { gFloorpStatusBar } from \"./browser-statusbar\";\r\nimport { ContextMenu } from \"./context-menu\";\r\nimport { StatusBar } from \"./statusbar\";\r\n\r\nexport function initStatusbar() {\r\n  render(() => <StatusBar />, document.getElementById(\"navigator-toolbox\"));\r\n  insert(\r\n    document.getElementById(\"toolbar-context-menu\"),\r\n    () => <ContextMenu />,\r\n    document.getElementById(\"viewToolbarsMenuSeparator\"),\r\n  );\r\n\r\n  // Initialize statusbar\r\n  gFloorpStatusBar.getInstance();\r\n}\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nexport function ContextMenu(id: string, l10n: string, runFunction: () => void) {\r\n  return (\r\n    <xul:menuitem\r\n      data-l10n-id={l10n}\r\n      label={l10n}\r\n      id={id}\r\n      onCommand={runFunction}\r\n    />\r\n  );\r\n}\r\n","import { insert } from \"@solid-xul/solid-xul\";\r\nimport { ContextMenu } from \"./context-menu\";\r\nimport type { JSXElement } from \"solid-js\";\r\n\r\nclass gFloorpContextMenuServices {\r\n  initialized = false;\r\n  checkItems: (() => void)[] = [];\r\n  contextMenuObserver: MutationObserver = new MutationObserver(() => {\r\n    this.contextMenuObserverFunc();\r\n  });\r\n\r\n  get windowModalDialogElem() {\r\n    return document.getElementById(\"window-modal-dialog\") as XULElement;\r\n  }\r\n  get screenShotContextMenuItems() {\r\n    return document.getElementById(\"context-take-screenshot\") as XULElement;\r\n  }\r\n  get contentAreaContextMenu() {\r\n    return document.getElementById(\"contentAreaContextMenu\") as XULElement;\r\n  }\r\n  get pdfjsContextMenuSeparator() {\r\n    return document.getElementById(\"context-sep-pdfjs-selectall\") as XULElement;\r\n  }\r\n  get contextMenuSeparators(): NodeListOf<XULElement> {\r\n    return document.querySelectorAll(\"#contentAreaContextMenu > menuseparator\");\r\n  }\r\n\r\n  init() {\r\n    if (this.initialized) {\r\n      return;\r\n    }\r\n    this.contentAreaContextMenu.addEventListener(\"popupshowing\", () =>\r\n      this.onPopupShowing(),\r\n    );\r\n    this.initialized = true;\r\n  }\r\n\r\n  addContextBox(\r\n    id: string,\r\n    l10n: string,\r\n    insertElementId: string,\r\n    runFunction: () => void,\r\n    checkID: string,\r\n    checkedFunction: () => void,\r\n  ) {\r\n    const contextMenu = ContextMenu(id, l10n, runFunction);\r\n    const targetNode = document.getElementById(checkID) as XULElement;\r\n    const insertElement = document.getElementById(\r\n      insertElementId,\r\n    ) as XULElement;\r\n\r\n    insert(this.contentAreaContextMenu, () => contextMenu, insertElement);\r\n    this.contextMenuObserver.observe(targetNode, { attributes: true });\r\n    this.checkItems.push(checkedFunction);\r\n    this.contextMenuObserverFunc();\r\n  }\r\n\r\n  contextMenuObserverFunc() {\r\n    for (const checkItem of this.checkItems) {\r\n      checkItem();\r\n    }\r\n  }\r\n\r\n  addToolbarContentMenuPopupSet(JSXElem: JSXElement) {\r\n    insert(document.body, JSXElem, this.windowModalDialogElem);\r\n  }\r\n\r\n  onPopupShowing() {\r\n    if (!this.screenShotContextMenuItems.hidden) {\r\n      this.pdfjsContextMenuSeparator.hidden = false;\r\n\r\n      const nextSibling = this.screenShotContextMenuItems\r\n        .nextSibling as XULElement;\r\n      if (nextSibling) {\r\n        nextSibling.hidden = false;\r\n      }\r\n    }\r\n\r\n    (async () => {\r\n      for (const contextMenuSeparator of this.contextMenuSeparators) {\r\n        if (\r\n          contextMenuSeparator.nextSibling.hidden &&\r\n          contextMenuSeparator.previousSibling.hidden &&\r\n          contextMenuSeparator.id !== \"context-sep-navigation\" &&\r\n          contextMenuSeparator.id !== \"context-sep-pdfjs-selectall\"\r\n        ) {\r\n          contextMenuSeparator.hidden = true;\r\n        }\r\n      }\r\n    })();\r\n  }\r\n}\r\n\r\nexport const gFloorpContextMenu = new gFloorpContextMenuServices();\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { gFloorpContextMenu } from \"./browser-context-menu\";\r\n\r\nexport function initBrowserContextMenu() {\r\n  gFloorpContextMenu.init();\r\n}\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nconst { ContextualIdentityService } = ChromeUtils.importESModule(\r\n  \"resource://gre/modules/ContextualIdentityService.sys.mjs\",\r\n);\r\n\r\nexport const PrivateContainer = {\r\n  ENABLE_PRIVATE_CONTAINER_PREF: \"floorp.privateContainer.enabled\",\r\n  PRIVATE_CONTAINER_L10N_ID: \"floorp-private-container-name\",\r\n  getPrivateContainer() {\r\n    const currentContainers = ContextualIdentityService._identities;\r\n    return currentContainers.find(\r\n      (container: { floorpPrivateContainer: boolean }) =>\r\n        container.floorpPrivateContainer === true,\r\n    );\r\n  },\r\n\r\n  getPrivateContainerUserContextId() {\r\n    const privateContainer = this.getPrivateContainer();\r\n    return privateContainer ? privateContainer.userContextId : null;\r\n  },\r\n\r\n  removePrivateContainerData() {\r\n    const privateContainer = this.getPrivateContainer();\r\n    if (!privateContainer || !privateContainer.userContextId) {\r\n      return;\r\n    }\r\n\r\n    Services.clearData.deleteDataFromOriginAttributesPattern({\r\n      userContextId: privateContainer.userContextId,\r\n    });\r\n  },\r\n\r\n  async StartupCreatePrivateContainer() {\r\n    const l10n = new Localization([\"browser/floorp.ftl\"], true);\r\n    ContextualIdentityService.ensureDataReady();\r\n\r\n    if (PrivateContainer.getPrivateContainer()) {\r\n      return;\r\n    }\r\n\r\n    const userContextId = ++ContextualIdentityService._lastUserContextId;\r\n\r\n    const identity = {\r\n      userContextId,\r\n      public: true,\r\n      icon: \"chill\",\r\n      color: \"purple\",\r\n      name: await l10n.formatValue(\r\n        PrivateContainer.PRIVATE_CONTAINER_L10N_ID\r\n      ),\r\n      floorpPrivateContainer: true,\r\n    };\r\n\r\n    ContextualIdentityService._identities.push(identity);\r\n    ContextualIdentityService.saveSoon();\r\n    Services.obs.notifyObservers(\r\n      ContextualIdentityService.getIdentityObserverOutput(identity),\r\n      \"contextual-identity-created\",\r\n    );\r\n  },\r\n};\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { gFloorpContextMenu } from \"../context-menu/browser-context-menu\";\r\nimport { PrivateContainer } from \"./PrivateContainer\";\r\n\r\nexport class gFloorpPrivateContainer {\r\n  private static instance: gFloorpPrivateContainer;\r\n  private initialized = false;\r\n\r\n  private get privateContainerMenuItem() {\r\n    return document.querySelector(\"#open_in_private_container\") as XULElement;\r\n  }\r\n  private get openLinkMenuItem() {\r\n    return document.querySelector(\"#context-openlink\") as XULElement;\r\n  }\r\n\r\n  public static getInstance() {\r\n    if (!gFloorpPrivateContainer.instance) {\r\n      gFloorpPrivateContainer.instance = new gFloorpPrivateContainer();\r\n    }\r\n    return gFloorpPrivateContainer.instance;\r\n  }\r\n\r\n  constructor() {\r\n    if (this.initialized) {\r\n      return;\r\n    }\r\n\r\n    // Create a private container.\r\n    PrivateContainer.StartupCreatePrivateContainer();\r\n    PrivateContainer.removePrivateContainerData();\r\n\r\n    window.SessionStore.promiseInitialized.then(() => {\r\n      window.gBrowser.tabContainer.addEventListener(\r\n        \"TabClose\",\r\n        gFloorpPrivateContainer.removeDataIfPrivateContainerTabNotExist,\r\n      );\r\n\r\n      window.gBrowser.tabContainer.addEventListener(\r\n        \"TabOpen\",\r\n        gFloorpPrivateContainer.handleTabModifications,\r\n      );\r\n\r\n      document.addEventListener(\r\n        \"floorpOnLocationChangeEvent\",\r\n        gFloorpPrivateContainer.handleTabModifications,\r\n      );\r\n\r\n      // add URL link a context menu to open in private container.\r\n      gFloorpContextMenu.addContextBox(\r\n        \"open_in_private_container\",\r\n        \"open-in_private-container\",\r\n        \"context-openlink\",\r\n        () =>\r\n          gFloorpPrivateContainer.openWithPrivateContainer(\r\n            window.gContextMenu.linkURL,\r\n          ),\r\n        \"context-openlink\",\r\n        () => {\r\n          this.privateContainerMenuItem.hidden = this.openLinkMenuItem.hidden;\r\n        },\r\n      );\r\n    });\r\n\r\n    this.initialized = true;\r\n  }\r\n\r\n  public getPrivateContainerUserContextId() {\r\n    return PrivateContainer.getPrivateContainerUserContextId();\r\n  }\r\n\r\n  public static checkPrivateContainerTabExist() {\r\n    const privateContainer = PrivateContainer.getPrivateContainer();\r\n    if (!privateContainer || !privateContainer.userContextId) {\r\n      return false;\r\n    }\r\n    return window.gBrowser.tabs.some(\r\n      (tab: { userContextId: number }) =>\r\n        tab.userContextId === privateContainer.userContextId,\r\n    );\r\n  }\r\n\r\n  private static removeDataIfPrivateContainerTabNotExist() {\r\n    const privateContainerUserContextID =\r\n      PrivateContainer.getPrivateContainerUserContextId();\r\n    setTimeout(() => {\r\n      if (!gFloorpPrivateContainer.checkPrivateContainerTabExist()) {\r\n        PrivateContainer.removePrivateContainerData();\r\n      }\r\n\r\n      return window.gBrowser.tabs.filter(\r\n        (tab: { userContextId: number }) =>\r\n          tab.userContextId === privateContainerUserContextID,\r\n      );\r\n    }, 400);\r\n  }\r\n\r\n  private static tabIsSaveHistory(tab: {\r\n    getAttribute: (arg0: string) => string;\r\n  }) {\r\n    return tab.getAttribute(\"historydisabled\") === \"true\";\r\n  }\r\n\r\n  private static applyDoNotSaveHistoryToTab(tab: {\r\n    linkedBrowser: { setAttribute: (arg0: string, arg1: string) => void };\r\n    setAttribute: (arg0: string, arg1: string) => void;\r\n  }) {\r\n    tab.linkedBrowser.setAttribute(\"disablehistory\", \"true\");\r\n    tab.linkedBrowser.setAttribute(\"disableglobalhistory\", \"true\");\r\n    tab.setAttribute(\"floorp-disablehistory\", \"true\");\r\n  }\r\n\r\n  private static checkTabIsPrivateContainer(tab: { userContextId: number }) {\r\n    const privateContainerUserContextID =\r\n      PrivateContainer.getPrivateContainerUserContextId();\r\n    return tab.userContextId === privateContainerUserContextID;\r\n  }\r\n\r\n  private static handleTabModifications() {\r\n    const tabs = window.gBrowser.tabs;\r\n    for (const tab of tabs) {\r\n      if (\r\n        gFloorpPrivateContainer.checkTabIsPrivateContainer(tab) &&\r\n        !gFloorpPrivateContainer.tabIsSaveHistory(tab)\r\n      ) {\r\n        gFloorpPrivateContainer.applyDoNotSaveHistoryToTab(tab);\r\n      }\r\n    }\r\n  }\r\n\r\n  public static openWithPrivateContainer(url: URI) {\r\n    let relatedToCurrent = false; //\"relatedToCurrent\" decide where to open the new tab. Default work as last tab (right side). Floorp use this.\r\n    const _OPEN_NEW_TAB_POSITION_PREF = Services.prefs.getIntPref(\r\n      \"floorp.browser.tabs.openNewTabPosition\",\r\n      -1,\r\n    );\r\n    switch (_OPEN_NEW_TAB_POSITION_PREF) {\r\n      case 0:\r\n        // Open the new tab as unrelated to the current tab.\r\n        relatedToCurrent = false;\r\n        break;\r\n      case 1:\r\n        // Open the new tab as related to the current tab.\r\n        relatedToCurrent = true;\r\n        break;\r\n    }\r\n    const privateContainerUserContextID =\r\n      PrivateContainer.getPrivateContainerUserContextId();\r\n    Services.obs.notifyObservers(\r\n      {\r\n        wrappedJSObject: new Promise((resolve) => {\r\n          window.openTrustedLinkIn(url, \"tab\", {\r\n            relatedToCurrent,\r\n            resolveOnNewTabCreated: resolve,\r\n            userContextId: privateContainerUserContextID,\r\n          });\r\n        }),\r\n      },\r\n      \"browser-open-newtab-start\",\r\n    );\r\n  }\r\n\r\n  public static reopenInPrivateContainer() {\r\n    let userContextId = PrivateContainer.getPrivateContainerUserContextId();\r\n    const reopenedTabs = window.TabContextMenu.contextTab.multiselected\r\n      ? window.gBrowser.selectedTabs\r\n      : [window.TabContextMenu.contextTab];\r\n\r\n    for (const tab of reopenedTabs) {\r\n      /* Create a triggering principal that is able to load the new tab\r\n          For content principals that are about: chrome: or resource: we need system to load them.\r\n          Anything other than system principal needs to have the new userContextId.\r\n       */\r\n      let triggeringPrincipal: nsIPrincipal;\r\n\r\n      if (tab.linkedPanel) {\r\n        triggeringPrincipal = tab.linkedBrowser.contentPrincipal;\r\n      } else {\r\n        // For lazy tab browsers, get the original principal\r\n        // from SessionStore\r\n        const tabState = JSON.parse(window.SessionStore.getTabState(tab));\r\n        try {\r\n          triggeringPrincipal = window.E10SUtils.deserializePrincipal(\r\n            tabState.triggeringPrincipal_base64,\r\n          );\r\n        } catch (ex) {\r\n          continue;\r\n        }\r\n      }\r\n\r\n      if (!triggeringPrincipal || triggeringPrincipal.isNullPrincipal) {\r\n        // Ensure that we have a null principal if we couldn't\r\n        // deserialize it (for lazy tab browsers) ...\r\n        // This won't always work however is safe to use.\r\n        triggeringPrincipal =\r\n          Services.scriptSecurityManager.createNullPrincipal({\r\n            userContextId,\r\n          });\r\n      } else if (triggeringPrincipal.isContentPrincipal) {\r\n        triggeringPrincipal = Services.scriptSecurityManager.principalWithOA(\r\n          triggeringPrincipal,\r\n          {\r\n            userContextId,\r\n          },\r\n        );\r\n      }\r\n\r\n      const currentTabUserContextId = Number.parseInt(\r\n        tab.getAttribute(\"usercontextid\"),\r\n      );\r\n\r\n      if (currentTabUserContextId === userContextId) {\r\n        userContextId = 0;\r\n      }\r\n\r\n      const newTab = window.gBrowser.addTab(tab.linkedBrowser.currentURI.spec, {\r\n        userContextId,\r\n        pinned: tab.pinned,\r\n        index: tab._tPos + 1,\r\n        triggeringPrincipal,\r\n      });\r\n\r\n      if (window.gBrowser.selectedTab === tab) {\r\n        window.gBrowser.selectedTab = newTab;\r\n      }\r\n      if (tab.muted && !newTab.muted) {\r\n        newTab.toggleMuteAudio(tab.muteReason);\r\n      }\r\n\r\n      window.gBrowser.removeTab(tab);\r\n    }\r\n  }\r\n}\r\n","import { gFloorpPrivateContainer } from \"./browser-private-container\";\r\n\r\nexport function ContextMenu() {\r\n  return (\r\n    <xul:menuitem\r\n      id=\"context_toggleToPrivateContainer\"\r\n      data-l10n-id=\"floorp-toggle-private-container\"\r\n      label=\"Toggle to Private Container\"\r\n      onCommand={() => {\r\n        gFloorpPrivateContainer.reopenInPrivateContainer();\r\n      }}\r\n    />\r\n  );\r\n}\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { insert } from \"@solid-xul/solid-xul\";\r\nimport { gFloorpPrivateContainer } from \"./browser-private-container\";\r\nimport { ContextMenu } from \"./context-menu\";\r\n\r\nexport function initPrivateContainer() {\r\n  insert(\r\n    document.querySelector(\"#tabContextMenu\"),\r\n    () => <ContextMenu />,\r\n    document.querySelector(\"#context_selectAllTabs\"),\r\n  );\r\n  // Inject menu item to open link in private container.\r\n  window.gFloorpPrivateContainer = gFloorpPrivateContainer.getInstance();\r\n  console.log(window.gFloorpPrivateContainer)\r\n}\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { createSignal } from \"solid-js\";\r\nimport { Show } from \"solid-js\";\r\nimport shareModeStyle from \"./share-mode.pcss?inline\";\r\n\r\nexport const [shareModeEnabled, setShareModeEnabled] = createSignal(false);\r\nexport function ShareModeElement() {\r\n  return (\r\n    <>\r\n      <xul:menuitem\r\n        data-l10n-id=\"sharemode-menuitem\"\r\n        label=\"Toggle Share Mode\"\r\n        type=\"checkbox\"\r\n        id=\"toggle_sharemode\"\r\n        checked={false}\r\n        onCommand={() => setShareModeEnabled((prev) => !prev)}\r\n        accesskey=\"S\"\r\n      />\r\n\r\n      <Show when={shareModeEnabled()}>\r\n        <style>{shareModeStyle}</style>\r\n      </Show>\r\n    </>\r\n  );\r\n}\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { insert } from \"@solid-xul/solid-xul\";\r\nimport { ShareModeElement } from \"./browser-share-mode\";\r\n\r\nexport function initShareMode() {\r\n  insert(\r\n    document.querySelector(\"#menu_ToolsPopup\"),\r\n    () => <ShareModeElement />,\r\n    document.querySelector(\"#menu_openFirefoxView\"),\r\n  );\r\n}\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\n// NOTICE: Do not add toolbar buttons code here. Create new folder or file for new toolbar buttons.\r\n\r\nimport { insert } from \"@solid-xul/solid-xul\";\r\nimport type { JSXElement } from \"solid-js\";\r\n\r\nconst { CustomizableUI } = ChromeUtils.importESModule(\r\n  \"resource:///modules/CustomizableUI.sys.mjs\",\r\n);\r\n\r\nexport const gFloorpBrowserAction = {\r\n  createToolbarClickActionButton(\r\n    widgetId: string,\r\n    l10nId: string,\r\n    onCommandFunc: () => void,\r\n    styleElement: JSXElement | null = null,\r\n    area: string = CustomizableUI.AREA_NAVBAR,\r\n    position: number | null = null,\r\n    onCreatedFunc: null | ((aNode: XULElement) => void) = null,\r\n  ) {\r\n    // Add style Element for toolbar button icon.\r\n    // This insert is runnning every open browser window.\r\n    insert(document.head, () => styleElement, document.head?.lastChild);\r\n\r\n    // Create toolbar button. If widget already exists, return.\r\n    // custom type is temporary widget type. It will be changed to button type.\r\n    const widget = CustomizableUI.getWidget(widgetId);\r\n    if (widget && widget.type !== \"custom\") {\r\n      return;\r\n    }\r\n    (async () => {\r\n      CustomizableUI.createWidget({\r\n        id: widgetId,\r\n        type: \"button\",\r\n        tooltiptext: await document.l10n?.formatValue(l10nId),\r\n        label: await document.l10n?.formatValue(l10nId),\r\n        removable: true,\r\n        onCommand: () => {\r\n          onCommandFunc?.();\r\n        },\r\n        onCreated: (aNode: XULElement) => {\r\n          onCreatedFunc?.(aNode);\r\n        },\r\n      });\r\n      if (\r\n        ChromeUtils.importESModule(\"resource://floorp/FloorpStartup.sys.mjs\")\r\n          .isFirstRun\r\n      ) {\r\n        CustomizableUI.addWidgetToArea(widgetId, area, position);\r\n      }\r\n    })();\r\n  },\r\n\r\n  createMenuToolbarButton(\r\n    widgetId: string,\r\n    l10nId: string,\r\n    popupElem: JSXElement,\r\n    onCommandFunc: () => void,\r\n    area: string = CustomizableUI.AREA_NAVBAR,\r\n    styleElement: JSXElement | null = null,\r\n    position: number | null = null,\r\n    onCreatedFunc: null | ((aNode: XULElement) => void) = null,\r\n  ) {\r\n    insert(document.head, () => styleElement, document.head?.lastChild);\r\n\r\n    const widget = CustomizableUI.getWidget(widgetId);\r\n    if (widget && widget.type !== \"custom\") {\r\n      return;\r\n    }\r\n    (async () => {\r\n      CustomizableUI.createWidget({\r\n        id: widgetId,\r\n        type: \"button\",\r\n        tooltiptext: await document.l10n?.formatValue(l10nId),\r\n        label: await document.l10n?.formatValue(l10nId),\r\n        removable: true,\r\n        onCommand: () => {\r\n          onCommandFunc?.();\r\n        },\r\n        onCreated: (aNode: XULElement) => {\r\n          aNode.setAttribute(\"type\", \"menu\");\r\n          insert(aNode, () => popupElem, aNode.lastChild);\r\n          onCreatedFunc?.(aNode);\r\n        },\r\n      });\r\n      if (\r\n        ChromeUtils.importESModule(\"resource://floorp/FloorpStartup.sys.mjs\")\r\n          .isFirstRun\r\n      ) {\r\n        CustomizableUI.addWidgetToArea(widgetId, area, position);\r\n      }\r\n    })();\r\n  },\r\n};\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { gFloorpBrowserAction } from \"../browser-action/browser-action\";\r\nimport iconStyle from \"./icon.pcss?inline\";\r\n\r\nconst { CustomizableUI } = ChromeUtils.importESModule(\r\n  \"resource:///modules/CustomizableUI.sys.mjs\",\r\n);\r\n\r\nexport class gReverseSidebarPosition {\r\n  private static instance: gReverseSidebarPosition;\r\n  public static getInstance() {\r\n    if (!gReverseSidebarPosition.instance) {\r\n      gReverseSidebarPosition.instance = new gReverseSidebarPosition();\r\n    }\r\n    return gReverseSidebarPosition.instance;\r\n  }\r\n  private StyleElement = () => {\r\n    return <style>{iconStyle}</style>;\r\n  };\r\n\r\n  constructor() {\r\n    gFloorpBrowserAction.createToolbarClickActionButton(\r\n      \"sidebar-reverse-position-toolbar\",\r\n      \"sidebar-reverse-position-toolbar\",\r\n      () => {\r\n        window.SidebarUI.reversePosition();\r\n      },\r\n      this.StyleElement(),\r\n      CustomizableUI.AREA_NAVBAR,\r\n      2,\r\n      () => {\r\n        const onFirstLaunch = ChromeUtils.importESModule(\r\n          \"resource://floorp/FloorpStartup.sys.mjs\"\r\n        ).isFirstRun\r\n\r\n        if (onFirstLaunch) {\r\n          // Sidebar button should right side of navbar\r\n          CustomizableUI.addWidgetToArea(\r\n            \"sidebar-button\",\r\n            CustomizableUI.AREA_NAVBAR,\r\n            3,\r\n         );\r\n        }\r\n      },\r\n    );\r\n  }\r\n}\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { gReverseSidebarPosition } from \"./reverse-sidebar-position\";\r\n\r\nexport function initReverseSidebarPosition() {\r\n  gReverseSidebarPosition.getInstance();\r\n}\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { gFloorpBrowserAction } from \"../browser-action/browser-action\";\r\nimport iconStyle from \"./icon.pcss?inline\";\r\n\r\nconst { CustomizableUI } = ChromeUtils.importESModule(\r\n  \"resource:///modules/CustomizableUI.sys.mjs\",\r\n);\r\n\r\nexport class gFloorpUndoClosedTab {\r\n  private static instance: gFloorpUndoClosedTab;\r\n  public static getInstance() {\r\n    if (!gFloorpUndoClosedTab.instance) {\r\n      gFloorpUndoClosedTab.instance = new gFloorpUndoClosedTab();\r\n    }\r\n    return gFloorpUndoClosedTab.instance;\r\n  }\r\n  private StyleElement = () => {\r\n    return <style>{iconStyle}</style>;\r\n  };\r\n\r\n  constructor() {\r\n    gFloorpBrowserAction.createToolbarClickActionButton(\r\n      \"undo-closed-tab\",\r\n      \"undo-closed-tab\",\r\n      () => {\r\n        window.undoCloseTab();\r\n      },\r\n      this.StyleElement(),\r\n      CustomizableUI.AREA_NAVBAR,\r\n      0,\r\n    );\r\n  }\r\n}\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { gFloorpUndoClosedTab } from \"./browser-undo-closed-tab\";\r\n\r\nexport function initUndoClosedTab() {\r\n  gFloorpUndoClosedTab.getInstance();\r\n}\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nexport function MenuPopup() {\r\n  return (\r\n    <xul:menupopup id=\"profile-manager-popup\">\r\n      <xul:browser\r\n        id=\"profile-switcher-browser\"\r\n        src=\"chrome://floorp/content/profile-manager/profile-switcher.xhtml\"\r\n        flex=\"1\"\r\n        type=\"content\"\r\n        disablehistory=\"true\"\r\n        disableglobalhistory=\"true\"\r\n        context=\"profile-popup-contextmenu\"\r\n      />\r\n    </xul:menupopup>\r\n  );\r\n}\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { gFloorpBrowserAction } from \"../browser-action/browser-action\";\r\nimport { MenuPopup } from \"./menupopup\";\r\nimport profileManagerStyle from \"./profile-manager.pcss?inline\";\r\n\r\nconst { CustomizableUI } = ChromeUtils.importESModule(\r\n  \"resource:///modules/CustomizableUI.sys.mjs\",\r\n);\r\n\r\nexport class gFloorpProfileManager {\r\n  private static instance: gFloorpProfileManager;\r\n  public static getInstance() {\r\n    if (!gFloorpProfileManager.instance) {\r\n      gFloorpProfileManager.instance = new gFloorpProfileManager();\r\n    }\r\n    return gFloorpProfileManager.instance;\r\n  }\r\n\r\n  private StyleElement = () => {\r\n    return <style>{profileManagerStyle}</style>;\r\n  };\r\n\r\n  constructor() {\r\n    gFloorpBrowserAction.createMenuToolbarButton(\r\n      \"profile-manager\",\r\n      \"floorp-profile-manager\",\r\n      <MenuPopup />,\r\n      async () => {\r\n        const popup = document.getElementById(\r\n          \"profile-manager-popup\",\r\n        ) as XULPopupElement;\r\n        popup?.openPopup(\r\n          document.getElementById(\"profile-manager-popup\"),\r\n          \"after_start\",\r\n          0,\r\n          0,\r\n          false,\r\n          false,\r\n        );\r\n      },\r\n      CustomizableUI.AREA_NAVBAR,\r\n      this.StyleElement(),\r\n      15,\r\n    );\r\n  }\r\n}\r\n","/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*-\r\n * This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { gFloorpProfileManager } from \"./browser-profile-manager\";\r\n\r\nexport function initProfileManager() {\r\n  gFloorpProfileManager.getInstance();\r\n}\r\n","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\r\n\r\nimport { CustomShortcutKey } from \"../components/custom-shortcut-key\";\r\nimport { initStatusbar } from \"./statusbar\";\r\nimport { initBrowserContextMenu } from \"./context-menu\";\r\nimport { initPrivateContainer } from \"./private-container\";\r\nimport { initShareMode } from \"./share-mode\";\r\nimport { initReverseSidebarPosition } from \"./reverse-sidebar-position\";\r\nimport { initUndoClosedTab } from \"./undo-closed-tab\";\r\nimport { initProfileManager } from \"./profile-manager\";\r\n\r\nCustomShortcutKey.getInstance();\r\n\r\nwindow.SessionStore.promiseInitialized.then(() => {\r\n  initBrowserContextMenu();\r\n  initPrivateContainer();\r\n  initShareMode();\r\n  initStatusbar();\r\n  initReverseSidebarPosition();\r\n  initUndoClosedTab();\r\n  initProfileManager();\r\n});\r\n"],"names":["showStatusbar","setShowStatusbar","createSignal","Services","prefs","getBoolPref","gFloorpStatusBar","getInstance","instance","statusbarEnabled","constructor","CustomizableUI","registerArea","type","window","TYPE_TOOLBAR","defaultPlacements","registerToolbarNode","document","getElementById","createEffect","statuspanel_label","statuspanel","statusText","observer","MutationObserver","getAttribute","setAttribute","removeAttribute","setBoolPref","appendChild","observe","attributes","disconnect","body","observeStatusbar","addObserver","ContextMenu","_el$","_$createElement","_$setProp","value","_$effect","_$p","StatusBar","_el$2","_$insertNode","_el$3","_$insert","statusbarStyle","initStatusbar","_$createComponent","insert","id","l10n","runFunction","gFloorpContextMenuServices","initialized","checkItems","contextMenuObserver","contextMenuObserverFunc","windowModalDialogElem","screenShotContextMenuItems","contentAreaContextMenu","pdfjsContextMenuSeparator","contextMenuSeparators","querySelectorAll","init","addEventListener","onPopupShowing","addContextBox","insertElementId","checkID","checkedFunction","contextMenu","targetNode","insertElement","push","checkItem","addToolbarContentMenuPopupSet","JSXElem","hidden","nextSibling","contextMenuSeparator","previousSibling","gFloorpContextMenu","initBrowserContextMenu","gFloorpPrivateContainer","PrivateContainer","StartupCreatePrivateContainer","removePrivateContainerData","SessionStore","promiseInitialized","then","gBrowser","tabContainer","removeDataIfPrivateContainerTabNotExist","handleTabModifications","openWithPrivateContainer","gContextMenu","linkURL","privateContainerMenuItem","openLinkMenuItem","querySelector","getPrivateContainerUserContextId","checkPrivateContainerTabExist","privateContainer","getPrivateContainer","userContextId","tabs","some","tab","privateContainerUserContextID","setTimeout","filter","tabIsSaveHistory","applyDoNotSaveHistoryToTab","linkedBrowser","checkTabIsPrivateContainer","url","relatedToCurrent","_OPEN_NEW_TAB_POSITION_PREF","getIntPref","obs","notifyObservers","wrappedJSObject","Promise","resolve","openTrustedLinkIn","resolveOnNewTabCreated","reopenInPrivateContainer","reopenedTabs","TabContextMenu","contextTab","multiselected","selectedTabs","triggeringPrincipal","linkedPanel","contentPrincipal","tabState","JSON","parse","getTabState","E10SUtils","deserializePrincipal","triggeringPrincipal_base64","ex","isNullPrincipal","scriptSecurityManager","createNullPrincipal","isContentPrincipal","principalWithOA","currentTabUserContextId","Number","parseInt","newTab","addTab","currentURI","spec","pinned","index","_tPos","selectedTab","muted","toggleMuteAudio","muteReason","removeTab","initPrivateContainer","log","shareModeEnabled","setShareModeEnabled","ShareModeElement","prev","Show","when","children","shareModeStyle","initShareMode","ChromeUtils","importESModule","gFloorpBrowserAction","createToolbarClickActionButton","widgetId","l10nId","onCommandFunc","styleElement","area","AREA_NAVBAR","position","onCreatedFunc","head","lastChild","widget","getWidget","createWidget","tooltiptext","formatValue","label","removable","onCommand","onCreated","aNode","isFirstRun","addWidgetToArea","createMenuToolbarButton","popupElem","gReverseSidebarPosition","StyleElement","iconStyle","SidebarUI","reversePosition","onFirstLaunch","gFloorpUndoClosedTab","undoCloseTab","MenuPopup","gFloorpProfileManager","profileManagerStyle","popup","openPopup"],"mappings":";;;;;;;AAQO,MAAM,qBAAN,MAAM,mBAAkB;AAAA,EAwCrB,cAAc;AAlCtB;AAAA;AAAA,uCAAc;AAiCd,mCAAmB,CAAA;AAEjB,SAAK,YAAY;AAEjB,YAAQ,KAAK,oBAAoB;AAAA,EACnC;AAAA,EArCA,OAAO,cAAc;AACf,QAAA,CAAC,mBAAkB,UAAU;AACb,yBAAA,WAAW,IAAI;IACnC;AACA,QAAI,CAAC,mBAAkB,QAAQ,SAAS,MAAM,GAAG;AAC7B,yBAAA,SAAS,oBAAoB,MAAM;AACnC,yBAAA,QAAQ,KAAK,MAAM;AACrC,cAAQ,IAAI,YAAY;AAAA,IAC1B;AAEA,aAAS,IAAI,YAAY,mBAAkB,UAAU,UAAU;AAC/D,WAAO,mBAAkB;AAAA,EAC3B;AAAA;AAAA,EAGA,QAAQ,OAAO,QAAQ,MAAc;AACnC,UAAM,IAAI,aAAa,UAAU,KAAK,MAAM,IAAI,CAAC;AACjD,QAAI,EAAE,SAAS;AACL,cAAA,EAAE,KAAK,MAAM;AAAA,QACnB,KAAK,eAAe;AACb,eAAA,cAAc,EAAE,KAAK;AAC1B;AAAA,QACF;AAAA,QACA,KAAK,eAAe;AAClB,eAAK,YAAY;AACT,kBAAA,IAAI,KAAK,OAAO;AACxB;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAAA,EASQ,cAAc;AAEpB,SAAK,UAAU,SAAS;AAAA,MACtB,KAAK;AAAA,QACH,SAAS,MAAM,cAAc,gCAAgC,IAAI;AAAA,MACnE;AAAA,IAAA;AAAA,EAEJ;AAAA,EACQ,oBAAoB,SAAiB;AACnC,YAAA,iBAAiB,WAAW,CAAC,OAAO;AAC1C,UAAI,KAAK,aAAa;AACpB,gBAAQ,IAAI,aAAa;AACzB;AAAA,MACF;AACA,UACE,CAAC,WAAW,OAAO,QAAQ,OAAO,EAAE,OAAO,CAAC,MAAM,GAAG,IAAI,SAAS,CAAC,CAAC,EACjE,WAAW,GACd;AACI,YAAA,sBAAsB,EAAE,GAAG;AACrB,kBAAA,KAAK,uCAAuC,EAAE,EAAE;AACxD;AAAA,QACF;AAEW,mBAAA,CAAC,MAAM,aAAa,KAAK,OAAO,QAAQ,KAAK,OAAO,GAAG;AAChE,gBAAM,MAAM;AACZ,gBAAM,EAAE,KAAK,MAAM,MAAM,UAAU,cAAe;AAClD,cACE,GAAG,WAAW,OACd,GAAG,YAAY,QACf,GAAG,YAAY,QACf,GAAG,aAAa,SAChB,GAAG,QAAQ,cAAe,KAC1B;AACS,qBAAA,GAAG,EAAE,QAAQ,EAAE;AAAA,UAC1B;AAAA,QACF;AAAA,MACF;AAAA,IAAA,CACD;AAAA,EACH;AACF;AApFE,cADW,oBACI;AACf,cAFW,oBAEI,WAAoB,CAAA;AAF9B,IAAM,oBAAN;ACAM,MAAA,CAACA,eAAeC,gBAAgB,IAAIC,aAC/CC,SAASC,MAAMC,YAAY,6BAA6B,KAAK,CAC/D;AACO,MAAMC,oBAAN,MAAMA,kBAAiB;AAAA,EAE5B,OAAcC,cAAc;AACtB,QAAA,CAACD,kBAAiBE,UAAU;AACbA,wBAAAA,WAAW,IAAIF;IAClC;AACA,WAAOA,kBAAiBE;AAAAA,EAC1B;AAAA,EAEA,IAAYC,mBAAmB;AAC7B,WAAON,SAASC,MAAMC,YAAY,6BAA6B,KAAK;AAAA,EACtE;AAAA,EAEAK,cAAc;;AACLC,WAAAA,eAAeC,aAAa,aAAa;AAAA,MAC9CC,MAAMC,OAAOH,eAAeI;AAAAA,MAC5BC,mBAAmB,CAAC,qBAAqB,mBAAmB;AAAA,IAAA,CAC7D;AACDF,WAAOH,eAAeM,oBACpBC,SAASC,eAAe,WAAW,CACrC;AAEAC,iBAAa,MAAM;AACXC,YAAAA,oBAAoBH,SAASC,eACjC,mBACF;AACMG,YAAAA,cAAcJ,SAASC,eAAe,aAAa;AACnDI,YAAAA,aAAaL,SAASC,eAAe,aAAa;AAClDK,YAAAA,WAAW,IAAIC,iBAAiB,MAAM;AAC1C,YAAIH,YAAYI,aAAa,UAAU,MAAM,UAAUH,YAAY;AACtDI,qBAAAA,aAAa,UAAU,MAAM;AAAA,QAAA,OACnC;AACLJ,mDAAYK,gBAAgB;AAAA,QAC9B;AAAA,MAAA,CACD;AAEDzB,eAASC,MAAMyB,YAAY,6BAA6B7B,cAAe,CAAA;AACvE,UAAIA,iBAAiB;AACnBuB,iDAAYO,YAAYT;AACxBG,iBAASO,QAAQT,aAAa;AAAA,UAAEU,YAAY;AAAA,QAAA,CAAM;AAAA,MAAA,OAC7C;AACLV,mDAAaQ,YAAYT;AACzBG,6CAAUS;AAAAA,MACZ;AAAA,IAAA,CACD;AAGDf,mBAASgB,SAAThB,mBAAeY,YAAYZ,SAASC,eAAe,WAAW;AAC9D,SAAKgB,iBAAiB;AAAA,EACxB;AAAA,EAEQA,mBAAmB;AAChB/B,aAAAA,MAAMgC,YAAY,6BAA6B,MACtDnC,iBAAiB,MAAM,KAAKQ,gBAAgB,CAC9C;AAAA,EACF;AACF;AAvDE,cADWH,mBACIE;AADV,IAAMF,mBAAN;ACJA,SAAS+B,gBAAc;AAC5B,UAAA,MAAA;AAAAC,QAAAA,OAAAC,cAAA,cAAA;AAAAD,YAAAA,MAAA,gBAEiB,YAAY;AAAAA,YAAAA,MAAA,SACnB,YAAY;AAAAA,YAAAA,MAAA,QACb,UAAU;AAAAA,YAAAA,MAAA,MACZ,kBAAkB;AAAAE,YAAAF,MAAA,aAEV,MAAMrC,iBAAkBwC,CAAU,UAAA,CAACA,KAAK,CAAC;AAAAC,WAAAC,SAAAH,QAAAF,MAAA,WAD3CtC,cAAc,GAAC2C,GAAA,CAAA;AAAAL,WAAAA;AAAAA,EAAAA;AAI9B;;ACVO,SAASM,YAAY;AAC1B,SAAA,EAAA,MAAA;AAAA,QAAAN,OAAAC,cAAA,aAAA,GAAAM,QAAAN,cAAA,UAAA;AAAAO,eAAAR,MAAAO,KAAA;AAAAP,YAAAA,MAAA,MAGS,WAAW;AAAAA,YAAAA,MAAA,eACF,YAAY;AAAAA,YAAAA,MAAA,gBACX,MAAM;AAAAA,YAAAA,MAAA,QAId,OAAO;AAAAA,YAAAA,MAAA,WACJ,sBAAsB;AAAAA,YAAAA,MAAA,aACpB,GAAG;AAAAO,YAAAA,OAAA,MAGR,aAAa;AAAAA,YAAAA,OAAA,SACV,QAAQ;AAAAA,YAAAA,OAAA,QACT,GAAG;AAAAA,YAAAA,OAAA,SACF,mBAAmB;AAAAF,WAAAA,CAAAA,QAAAH,QAAAF,MAXnB,SAAA,wCACNtC,cAAc,IAAI,KAAK,WACxB,IAAC2C,GAAA,CAAA;AAAAL,WAAAA;AAAAA,EAAA,GAAA,IAAA,MAAA;AAAAS,QAAAA,QAAAR,cAAA,OAAA;AAAAQ,YAAAA,OAAA,OAAA,IAAA;AAAAC,WAAAD,OAYQE,cAAc;AAAAF,WAAAA;AAAAA,MAAA;AAGhC;ACtBO,SAASG,gBAAgB;AACvB,SAAA,MAAAC,gBAAOP,WAAS,CAAA,CAAA,GAAK1B,SAASC,eAAe,mBAAmB,CAAC;AACxEiC,SACElC,SAASC,eAAe,sBAAsB,GAC9C,MAAAgC,gBAAOd,eAAW,CAAA,CAAA,GAClBnB,SAASC,eAAe,2BAA2B,CACrD;AAGAb,mBAAiBC,YAAY;AAC/B;ACfgB8B,SAAAA,cAAYgB,IAAYC,MAAcC,aAAyB;AAC7E,UAAA,MAAA;AAAAjB,QAAAA,OAAAC,cAAA,cAAA;AAAAD,YAAAA,MAAA,gBAEkBgB,IAAI;AAAAhB,YAAAA,MAAA,SACXgB,IAAI;AAAAhB,YAAAA,MAAA,MACPe,EAAE;AAAAf,YAAAA,MAAA,aACKiB,WAAW;AAAAjB,WAAAA;AAAAA,EAAAA;AAG5B;ACVA,MAAMkB,2BAA2B;AAAA,EAAjC;AACEC,uCAAc;AACdC,sCAA6B,CAAA;AAC7BC,+CAAwC,IAAIlC,iBAAiB,MAAM;AACjE,WAAKmC,wBAAwB;AAAA,IAAA,CAC9B;AAAA;AAAA,EAED,IAAIC,wBAAwB;AACnB3C,WAAAA,SAASC,eAAe,qBAAqB;AAAA,EACtD;AAAA,EACA,IAAI2C,6BAA6B;AACxB5C,WAAAA,SAASC,eAAe,yBAAyB;AAAA,EAC1D;AAAA,EACA,IAAI4C,yBAAyB;AACpB7C,WAAAA,SAASC,eAAe,wBAAwB;AAAA,EACzD;AAAA,EACA,IAAI6C,4BAA4B;AACvB9C,WAAAA,SAASC,eAAe,6BAA6B;AAAA,EAC9D;AAAA,EACA,IAAI8C,wBAAgD;AAC3C/C,WAAAA,SAASgD,iBAAiB,yCAAyC;AAAA,EAC5E;AAAA,EAEAC,OAAO;AACL,QAAI,KAAKV,aAAa;AACpB;AAAA,IACF;AACA,SAAKM,uBAAuBK,iBAAiB,gBAAgB,MAC3D,KAAKC,gBACP;AACA,SAAKZ,cAAc;AAAA,EACrB;AAAA,EAEAa,cACEjB,IACAC,MACAiB,iBACAhB,aACAiB,SACAC,iBACA;AACA,UAAMC,cAAcrC,cAAYgB,IAAIC,MAAMC,WAAW;AAC/CoB,UAAAA,aAAazD,SAASC,eAAeqD,OAAO;AAC5CI,UAAAA,gBAAgB1D,SAASC,eAC7BoD,eACF;AAEAnB,WAAO,KAAKW,wBAAwB,MAAMW,aAAaE,aAAa;AAC/DjB,SAAAA,oBAAoB5B,QAAQ4C,YAAY;AAAA,MAAE3C,YAAY;AAAA,IAAA,CAAM;AAC5D0B,SAAAA,WAAWmB,KAAKJ,eAAe;AACpC,SAAKb,wBAAwB;AAAA,EAC/B;AAAA,EAEAA,0BAA0B;AACbkB,eAAAA,aAAa,KAAKpB,YAAY;AAC7B;IACZ;AAAA,EACF;AAAA,EAEAqB,8BAA8BC,SAAqB;AACjD5B,WAAOlC,SAASgB,MAAM8C,SAAS,KAAKnB,qBAAqB;AAAA,EAC3D;AAAA,EAEAQ,iBAAiB;AACX,QAAA,CAAC,KAAKP,2BAA2BmB,QAAQ;AAC3C,WAAKjB,0BAA0BiB,SAAS;AAElCC,YAAAA,cAAc,KAAKpB,2BACtBoB;AACH,UAAIA,aAAa;AACfA,oBAAYD,SAAS;AAAA,MACvB;AAAA,IACF;AAEA,KAAC,YAAY;AACAE,iBAAAA,wBAAwB,KAAKlB,uBAAuB;AAE3DkB,YAAAA,qBAAqBD,YAAYD,UACjCE,qBAAqBC,gBAAgBH,UACrCE,qBAAqB9B,OAAO,4BAC5B8B,qBAAqB9B,OAAO,+BAC5B;AACA8B,+BAAqBF,SAAS;AAAA,QAChC;AAAA,MACF;AAAA,IAAA;EAEJ;AACF;AAEaI,MAAAA,qBAAqB,IAAI7B,2BAA2B;ACtF1D,SAAS8B,yBAAyB;AACvCD,qBAAmBlB,KAAK;AAC1B;ACJA,MAAM,EAAE,0BAA0B,IAAI,YAAY;AAAA,EAChD;AACF;AAEO,MAAM,mBAAmB;AAAA,EAC9B,+BAA+B;AAAA,EAC/B,2BAA2B;AAAA,EAC3B,sBAAsB;AACpB,UAAM,oBAAoB,0BAA0B;AACpD,WAAO,kBAAkB;AAAA,MACvB,CAAC,cACC,UAAU,2BAA2B;AAAA,IAAA;AAAA,EAE3C;AAAA,EAEA,mCAAmC;AAC3B,UAAA,mBAAmB,KAAK;AACvB,WAAA,mBAAmB,iBAAiB,gBAAgB;AAAA,EAC7D;AAAA,EAEA,6BAA6B;AACrB,UAAA,mBAAmB,KAAK;AAC9B,QAAI,CAAC,oBAAoB,CAAC,iBAAiB,eAAe;AACxD;AAAA,IACF;AAEA,aAAS,UAAU,sCAAsC;AAAA,MACvD,eAAe,iBAAiB;AAAA,IAAA,CACjC;AAAA,EACH;AAAA,EAEA,MAAM,gCAAgC;AACpC,UAAM,OAAO,IAAI,aAAa,CAAC,oBAAoB,GAAG,IAAI;AAC1D,8BAA0B,gBAAgB;AAEtC,QAAA,iBAAiB,uBAAuB;AAC1C;AAAA,IACF;AAEM,UAAA,gBAAgB,EAAE,0BAA0B;AAElD,UAAM,WAAW;AAAA,MACf;AAAA,MACA,QAAQ;AAAA,MACR,MAAM;AAAA,MACN,OAAO;AAAA,MACP,MAAM,MAAM,KAAK;AAAA,QACf,iBAAiB;AAAA,MACnB;AAAA,MACA,wBAAwB;AAAA,IAAA;AAGA,8BAAA,YAAY,KAAK,QAAQ;AACnD,8BAA0B,SAAS;AACnC,aAAS,IAAI;AAAA,MACX,0BAA0B,0BAA0B,QAAQ;AAAA,MAC5D;AAAA,IAAA;AAAA,EAEJ;AACF;ACxDO,MAAMoB,2BAAN,MAAMA,yBAAwB;AAAA,EAkBnC7E,cAAc;AAhBN+C,uCAAc;AAiBpB,QAAI,KAAKA,aAAa;AACpB;AAAA,IACF;AAGA+B,qBAAiBC,8BAA8B;AAC/CD,qBAAiBE,2BAA2B;AAErCC,WAAAA,aAAaC,mBAAmBC,KAAK,MAAM;AAChD/E,aAAOgF,SAASC,aAAa3B,iBAC3B,YACAmB,yBAAwBS,uCAC1B;AAEAlF,aAAOgF,SAASC,aAAa3B,iBAC3B,WACAmB,yBAAwBU,sBAC1B;AAES7B,eAAAA,iBACP,+BACAmB,yBAAwBU,sBAC1B;AAGAZ,yBAAmBf,cACjB,6BACA,6BACA,oBACA,MACEiB,yBAAwBW,yBACtBpF,OAAOqF,aAAaC,OACtB,GACF,oBACA,MAAM;AACCC,aAAAA,yBAAyBpB,SAAS,KAAKqB,iBAAiBrB;AAAAA,MAAAA,CAEjE;AAAA,IAAA,CACD;AAED,SAAKxB,cAAc;AAAA,EACrB;AAAA,EAxDA,IAAY4C,2BAA2B;AAC9BnF,WAAAA,SAASqF,cAAc,4BAA4B;AAAA,EAC5D;AAAA,EACA,IAAYD,mBAAmB;AACtBpF,WAAAA,SAASqF,cAAc,mBAAmB;AAAA,EACnD;AAAA,EAEA,OAAchG,cAAc;AACtB,QAAA,CAACgF,yBAAwB/E,UAAU;AACbA,+BAAAA,WAAW,IAAI+E;IACzC;AACA,WAAOA,yBAAwB/E;AAAAA,EACjC;AAAA,EA8COgG,mCAAmC;AACxC,WAAOhB,iBAAiBgB;EAC1B;AAAA,EAEA,OAAcC,gCAAgC;AACtCC,UAAAA,mBAAmBlB,iBAAiBmB;AAC1C,QAAI,CAACD,oBAAoB,CAACA,iBAAiBE,eAAe;AACjD,aAAA;AAAA,IACT;AACO9F,WAAAA,OAAOgF,SAASe,KAAKC,KAC1B,CAACC,QACCA,IAAIH,kBAAkBF,iBAAiBE,aAC3C;AAAA,EACF;AAAA,EAEA,OAAeZ,0CAA0C;AACjDgB,UAAAA,gCACJxB,iBAAiBgB;AACnBS,eAAW,MAAM;AACX,UAAA,CAAC1B,yBAAwBkB,iCAAiC;AAC5DjB,yBAAiBE,2BAA2B;AAAA,MAC9C;AAEO5E,aAAAA,OAAOgF,SAASe,KAAKK,OAC1B,CAACH,QACCA,IAAIH,kBAAkBI,6BAC1B;AAAA,OACC,GAAG;AAAA,EACR;AAAA,EAEA,OAAeG,iBAAiBJ,KAE7B;AACMA,WAAAA,IAAIrF,aAAa,iBAAiB,MAAM;AAAA,EACjD;AAAA,EAEA,OAAe0F,2BAA2BL,KAGvC;AACGM,QAAAA,cAAc1F,aAAa,kBAAkB,MAAM;AACnD0F,QAAAA,cAAc1F,aAAa,wBAAwB,MAAM;AACzDA,QAAAA,aAAa,yBAAyB,MAAM;AAAA,EAClD;AAAA,EAEA,OAAe2F,2BAA2BP,KAAgC;AAClEC,UAAAA,gCACJxB,iBAAiBgB;AACnB,WAAOO,IAAIH,kBAAkBI;AAAAA,EAC/B;AAAA,EAEA,OAAef,yBAAyB;AAChCY,UAAAA,OAAO/F,OAAOgF,SAASe;AAC7B,eAAWE,OAAOF,MAAM;AAEpBtB,UAAAA,yBAAwB+B,2BAA2BP,GAAG,KACtD,CAACxB,yBAAwB4B,iBAAiBJ,GAAG,GAC7C;AACAxB,iCAAwB6B,2BAA2BL,GAAG;AAAA,MACxD;AAAA,IACF;AAAA,EACF;AAAA,EAEA,OAAcb,yBAAyBqB,KAAU;AAC/C,QAAIC,mBAAmB;AACvB,UAAMC,8BAA8BtH,SAASC,MAAMsH,WACjD,0CACA,EACF;AACA,YAAQD,6BAA2B;AAAA,MACjC,KAAK;AAEgB,2BAAA;AACnB;AAAA,MACF,KAAK;AAEgB,2BAAA;AACnB;AAAA,IACJ;AACMT,UAAAA,gCACJxB,iBAAiBgB;AACnBrG,aAASwH,IAAIC,gBACX;AAAA,MACEC,iBAAiB,IAAIC,QAASC,CAAY,YAAA;AACjCC,eAAAA,kBAAkBT,KAAK,OAAO;AAAA,UACnCC;AAAAA,UACAS,wBAAwBF;AAAAA,UACxBnB,eAAeI;AAAAA,QAAAA,CAChB;AAAA,MAAA,CACF;AAAA,OAEH,2BACF;AAAA,EACF;AAAA,EAEA,OAAckB,2BAA2B;AACnCtB,QAAAA,gBAAgBpB,iBAAiBgB;AAC/B2B,UAAAA,eAAerH,OAAOsH,eAAeC,WAAWC,gBAClDxH,OAAOgF,SAASyC,eAChB,CAACzH,OAAOsH,eAAeC,UAAU;AAErC,eAAWtB,OAAOoB,cAAc;AAK1BK,UAAAA;AAEJ,UAAIzB,IAAI0B,aAAa;AACnBD,8BAAsBzB,IAAIM,cAAcqB;AAAAA,MAAAA,OACnC;AAGL,cAAMC,WAAWC,KAAKC,MAAM/H,OAAO6E,aAAamD,YAAY/B,GAAG,CAAC;AAC5D,YAAA;AACFyB,gCAAsB1H,OAAOiI,UAAUC,qBACrCL,SAASM,0BACX;AAAA,iBACOC,IAAI;AACX;AAAA,QACF;AAAA,MACF;AAEI,UAAA,CAACV,uBAAuBA,oBAAoBW,iBAAiB;AAK7DhJ,8BAAAA,SAASiJ,sBAAsBC,oBAAoB;AAAA,UACjDzC;AAAAA,QAAAA,CACD;AAAA,MAAA,WACM4B,oBAAoBc,oBAAoB;AAC3BnJ,8BAAAA,SAASiJ,sBAAsBG,gBACnDf,qBACA;AAAA,UACE5B;AAAAA,QAAAA,CAEJ;AAAA,MACF;AAEA,YAAM4C,0BAA0BC,OAAOC,SACrC3C,IAAIrF,aAAa,eAAe,CAClC;AAEA,UAAI8H,4BAA4B5C,eAAe;AAC7B,wBAAA;AAAA,MAClB;AAEA,YAAM+C,SAAS7I,OAAOgF,SAAS8D,OAAO7C,IAAIM,cAAcwC,WAAWC,MAAM;AAAA,QACvElD;AAAAA,QACAmD,QAAQhD,IAAIgD;AAAAA,QACZC,OAAOjD,IAAIkD,QAAQ;AAAA,QACnBzB;AAAAA,MAAAA,CACD;AAEG1H,UAAAA,OAAOgF,SAASoE,gBAAgBnD,KAAK;AACvCjG,eAAOgF,SAASoE,cAAcP;AAAAA,MAChC;AACA,UAAI5C,IAAIoD,SAAS,CAACR,OAAOQ,OAAO;AACvBC,eAAAA,gBAAgBrD,IAAIsD,UAAU;AAAA,MACvC;AAEOvE,aAAAA,SAASwE,UAAUvD,GAAG;AAAA,IAC/B;AAAA,EACF;AACF;AAlOE,cADWxB,0BACI/E;AADV,IAAM+E,0BAAN;ACNA,SAASlD,cAAc;AAC5B,UAAA,MAAA;AAAAC,QAAAA,OAAAC,cAAA,cAAA;AAAAD,YAAAA,MAAA,MAEO,kCAAkC;AAAAA,YAAAA,MAAA,gBACxB,iCAAiC;AAAAA,YAAAA,MAAA,SACxC,6BAA6B;AAAAA,YAAAA,MAAA,aACxB,MAAM;AACfiD,8BAAwB2C,yBAAyB;AAAA,IAAA,CAClD;AAAA5F,WAAAA;AAAAA,EAAAA;AAGP;ACJO,SAASiI,uBAAuB;AACrCnH,SACElC,SAASqF,cAAc,iBAAiB,GACxC,MAAApD,gBAAOd,aAAW,CAAA,CAAA,GAClBnB,SAASqF,cAAc,wBAAwB,CACjD;AAEOhB,SAAAA,0BAA0BA,wBAAwBhF;AACjDiK,UAAAA,IAAI1J,OAAOyE,uBAAuB;AAC5C;;ACTO,MAAM,CAACkF,kBAAkBC,mBAAmB,IAAIxK,aAAa,KAAK;AAClE,SAASyK,mBAAmB;AACjC,SAAA,EAAA,MAAA;AAAArI,QAAAA,OAAAC,cAAA,cAAA;AAAAD,YAAAA,MAAA,gBAGmB,oBAAoB;AAAAA,YAAAA,MAAA,SAC3B,mBAAmB;AAAAA,YAAAA,MAAA,QACpB,UAAU;AAAAA,YAAAA,MAAA,MACZ,kBAAkB;AAAAA,YAAAA,MAAA,WACZ,KAAK;AAAAE,YAAAF,MAAA,aACH,MAAMoI,oBAAqBE,CAAS,SAAA,CAACA,IAAI,CAAC;AAAAtI,YAAAA,MAAA,aAC3C,GAAG;AAAAA,WAAAA;AAAAA,EAAAA,GAAAa,GAAAA,gBAGd0H,MAAI;AAAA,IAAA,IAACC,OAAI;AAAA,aAAEL,iBAAiB;AAAA,IAAC;AAAA,IAAA,IAAAM,WAAA;AAAAlI,UAAAA,QAAAN,cAAA,OAAA;AAAAS,aAAAH,OACpBmI,cAAc;AAAAnI,aAAAA;AAAAA,IAAA;AAAA,EAAA,CAAA,CAAA;AAI9B;ACpBO,SAASoI,gBAAgB;AAC9B7H,SACElC,SAASqF,cAAc,kBAAkB,GACzC,MAAApD,gBAAOwH,kBAAgB,CAAA,CAAA,GACvBzJ,SAASqF,cAAc,uBAAuB,CAChD;AACF;ACJA,MAAM;AAAA,EAAA,gBAAE5F;AAAe,IAAIuK,YAAYC,eACrC,4CACF;AAEO,MAAMC,uBAAuB;AAAA,EAClCC,+BACEC,UACAC,QACAC,eACAC,eAAkC,MAClCC,OAAe/K,iBAAegL,aAC9BC,WAA0B,MAC1BC,gBAAsD,MACtD;;AAGAzI,WAAOlC,SAAS4K,MAAM,MAAML,eAAcvK,cAAS4K,SAAT5K,mBAAe6K,SAAS;AAI5DC,UAAAA,SAASrL,iBAAesL,UAAUX,QAAQ;AAC5CU,QAAAA,UAAUA,OAAOnL,SAAS,UAAU;AACtC;AAAA,IACF;AACA,KAAC,YAAY;;AACXF,uBAAeuL,aAAa;AAAA,QAC1B7I,IAAIiI;AAAAA,QACJzK,MAAM;AAAA,QACNsL,aAAa,QAAMjL,MAAAA,SAASoC,SAATpC,gBAAAA,IAAekL,YAAYb;AAAAA,QAC9Cc,OAAO,QAAMnL,cAASoC,SAATpC,mBAAekL,YAAYb;AAAAA,QACxCe,WAAW;AAAA,QACXC,WAAWA,MAAM;AACC;AAAA,QAClB;AAAA,QACAC,WAAWA,CAACC,UAAsB;AAChCZ,yDAAgBY;AAAAA,QAClB;AAAA,MAAA,CACD;AACD,UACEvB,YAAYC,eAAe,yCAAyC,EACjEuB,YACH;AACeC,yBAAAA,gBAAgBrB,UAAUI,MAAME,QAAQ;AAAA,MACzD;AAAA,IAAA;EAEJ;AAAA,EAEAgB,wBACEtB,UACAC,QACAsB,WACArB,eACAE,OAAe/K,iBAAegL,aAC9BF,eAAkC,MAClCG,WAA0B,MAC1BC,gBAAsD,MACtD;;AACAzI,WAAOlC,SAAS4K,MAAM,MAAML,eAAcvK,cAAS4K,SAAT5K,mBAAe6K,SAAS;AAE5DC,UAAAA,SAASrL,iBAAesL,UAAUX,QAAQ;AAC5CU,QAAAA,UAAUA,OAAOnL,SAAS,UAAU;AACtC;AAAA,IACF;AACA,KAAC,YAAY;;AACXF,uBAAeuL,aAAa;AAAA,QAC1B7I,IAAIiI;AAAAA,QACJzK,MAAM;AAAA,QACNsL,aAAa,QAAMjL,MAAAA,SAASoC,SAATpC,gBAAAA,IAAekL,YAAYb;AAAAA,QAC9Cc,OAAO,QAAMnL,cAASoC,SAATpC,mBAAekL,YAAYb;AAAAA,QACxCe,WAAW;AAAA,QACXC,WAAWA,MAAM;AACC;AAAA,QAClB;AAAA,QACAC,WAAWA,CAACC,UAAsB;AAC1B9K,gBAAAA,aAAa,QAAQ,MAAM;AACjCyB,iBAAOqJ,OAAO,MAAMI,WAAWJ,MAAMV,SAAS;AAC9CF,yDAAgBY;AAAAA,QAClB;AAAA,MAAA,CACD;AACD,UACEvB,YAAYC,eAAe,yCAAyC,EACjEuB,YACH;AACeC,yBAAAA,gBAAgBrB,UAAUI,MAAME,QAAQ;AAAA,MACzD;AAAA,IAAA;EAEJ;AACF;;ACzFA,MAAM;AAAA,EAAA,gBAAEjL;AAAe,IAAIuK,YAAYC,eACrC,4CACF;AAEO,MAAM2B,2BAAN,MAAMA,yBAAwB;AAAA,EAYnCpM,cAAc;AAJNqM,wCAAeA,MAAM;AAC3B,cAAA,MAAA;AAAAzK,YAAAA,OAAAC,cAAA,OAAA;AAAAS,eAAAV,MAAe0K,WAAS;AAAA1K,eAAAA;AAAAA,MAAAA;IAAA;AAIH+I,yBAAAA,+BACnB,oCACA,oCACA,MAAM;AACJvK,aAAOmM,UAAUC;IAAgB,GAEnC,KAAKH,gBACLpM,iBAAegL,aACf,GACA,MAAM;AACJ,YAAMwB,gBAAgBjC,YAAYC,eAChC,yCACF,EAAEuB;AAEF,UAAIS,eAAe;AAEjBxM,yBAAegM,gBACb,kBACAhM,iBAAegL,aACf,CACH;AAAA,MACD;AAAA,IAAA,CAEJ;AAAA,EACF;AAAA,EAnCA,OAAcpL,cAAc;AACtB,QAAA,CAACuM,yBAAwBtM,UAAU;AACbA,+BAAAA,WAAW,IAAIsM;IACzC;AACA,WAAOA,yBAAwBtM;AAAAA,EACjC;AA+BF;AArCE,cADWsM,0BACItM;AADV,IAAMsM,0BAAN;ACLA,SAAS,6BAA6B;AAC3C,0BAAwB,YAAY;AACtC;;ACDA,MAAM;AAAA,EAAA,gBAAEnM;AAAe,IAAIuK,YAAYC,eACrC,4CACF;AAEO,MAAMiC,wBAAN,MAAMA,sBAAqB;AAAA,EAYhC1M,cAAc;AAJNqM,wCAAeA,MAAM;AAC3B,cAAA,MAAA;AAAAzK,YAAAA,OAAAC,cAAA,OAAA;AAAAS,eAAAV,MAAe0K,SAAS;AAAA1K,eAAAA;AAAAA,MAAAA;IAAA;AAIH+I,yBAAAA,+BACnB,mBACA,mBACA,MAAM;AACJvK,aAAOuM,aAAa;AAAA,IAAA,GAEtB,KAAKN,aACLpM,GAAAA,iBAAegL,aACf,CACF;AAAA,EACF;AAAA,EArBA,OAAcpL,cAAc;AACtB,QAAA,CAAC6M,sBAAqB5M,UAAU;AACbA,4BAAAA,WAAW,IAAI4M;IACtC;AACA,WAAOA,sBAAqB5M;AAAAA,EAC9B;AAiBF;AAvBE,cADW4M,uBACI5M;AADV,IAAM4M,uBAAN;ACLA,SAAS,oBAAoB;AAClC,uBAAqB,YAAY;AACnC;ACJO,SAASE,YAAY;AAC1B,UAAA,MAAA;AAAA,QAAAhL,OAAAC,cAAA,eAAA,GAAAM,QAAAN,cAAA,aAAA;AAAAO,eAAAR,MAAAO,KAAA;AAAAP,YAAAA,MAAA,MACoB,uBAAuB;AAAAO,YAAAA,OAAA,MAElC,0BAA0B;AAAAA,YAAAA,OAAA,OACzB,gEAAgE;AAAAA,YAAAA,OAAA,QAC/D,GAAG;AAAAA,YAAAA,OAAA,QACH,SAAS;AAAAA,YAAAA,OAAA,kBACC,MAAM;AAAAA,YAAAA,OAAA,wBACA,MAAM;AAAAA,YAAAA,OAAA,WACnB,2BAA2B;AAAAP,WAAAA;AAAAA,EAAAA;AAI3C;;ACVA,MAAM;AAAA,EAAE3B;AAAe,IAAIuK,YAAYC,eACrC,4CACF;AAEO,MAAMoC,yBAAN,MAAMA,uBAAsB;AAAA,EAajC7M,cAAc;AAJNqM,wCAAeA,MAAM;AAC3B,cAAA,MAAA;AAAAzK,YAAAA,OAAAC,cAAA,OAAA;AAAAS,eAAAV,MAAekL,mBAAmB;AAAAlL,eAAAA;AAAAA,MAAAA;IAAA;AAIbsK,yBAAAA,wBACnB,mBACA,0BAAwBzJ,gBACvBmK,WAAS,CAAA,CAAA,GACV,YAAY;AACJG,YAAAA,QAAQvM,SAASC,eACrB,uBACF;AACOuM,qCAAAA,UACLxM,SAASC,eAAe,uBAAuB,GAC/C,eACA,GACA,GACA,OACA;AAAA,IACF,GAEFR,eAAegL,aACf,KAAKoB,gBACL,EACF;AAAA,EACF;AAAA,EAjCA,OAAcxM,cAAc;AACtB,QAAA,CAACgN,uBAAsB/M,UAAU;AACbA,6BAAAA,WAAW,IAAI+M;IACvC;AACA,WAAOA,uBAAsB/M;AAAAA,EAC/B;AA6BF;AAnCE,cADW+M,wBACI/M;AADV,IAAM+M,wBAAN;ACNA,SAAS,qBAAqB;AACnC,wBAAsB,YAAY;AACpC;ACIA,kBAAkB,YAAY;AAE9B,OAAO,aAAa,mBAAmB,KAAK,MAAM;AACzB;AACF;AACP;AACA;AACa;AACT;AACC;AACrB,CAAC;"}